nohup: ignoring input
3
/home/wxt/.conda/envs/halos3/lib/python3.10/site-packages/huggingface_hub/file_download.py:1132: FutureWarning: `resume_download` is deprecated and will be removed in version 1.0.0. Downloads always resume when possible. If you want to force a new download, use `force_download=True`.
  warnings.warn(
Making experiment directory /home/wxt/.cache/huggingface/hub/llama2_7b_sft_halos
WARNING: eval_every must be divisible by batch_size
Setting eval_every to 19968
no FSDP port specified; using open port for FSDP: 40573
seed: 1
exp_name: llama2_7b_sft_halos
datasets:
- hh
mode: train
debug: false
use_fsdp: true
fsdp_port: 40573
wandb:
  enabled: true
  entity: null
  project: archangel
cache_dir: /home/wxt/.cache/huggingface/hub
local_run_dir: /home/wxt/.cache/huggingface/hub/llama2_7b_sft_halos
do_first_eval: true
minimum_log_interval_secs: 1.0
intermediate_checkpoints: false
trainer: SFTTrainer
lr: 1.0e-06
n_epochs: 1
n_examples: null
optimizer: RMSprop
warmup_steps: 150
eval_every: 19968
n_samples: 128
samples_dir: samples/
n_eval_examples: 512
saved_policy: /home/wxt/.cache/huggingface/hub/llama2_7b_sft_halos/LATEST/policy.pt
top_p: 0.95
human_prefix: '

  <|user|>

  '
assistant_prefix: '

  <|assistant|>

  '
human_suffix: ''
assistant_suffix: ''
frac_unique_desirable: 1.0
frac_unique_undesirable: 1.0
model:
  name_or_path: daryl149/llama-2-7b-hf
  tokenizer_name_or_path: null
  load_from: null
  block_name: LlamaDecoderLayer
  policy_dtype: bfloat16
  fsdp_policy_mp: null
  reference_dtype: bfloat16
  max_grad_norm: 10.0
  v_head_max_grad_norm: 0.1
  max_length: 1024
  max_prompt_length: 512
  activation_checkpointing: true
  batch_size: 128
  gradient_accumulation_steps: 2
  eval_batch_size: 16
  use_flash_attention: false
loss:
  name: sft
  trainer: SFTTrainer
  dataloader: SFTDataLoader
  use_reference_model: false

================================================================================
Writing to design-agent-09:/home/wxt/.cache/huggingface/hub/llama2_7b_sft_halos
================================================================================
building policy
Loading checkpoint shards:   0%|          | 0/2 [00:00<?, ?it/s]Loading checkpoint shards:  50%|█████     | 1/2 [00:03<00:03,  3.29s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  2.19s/it]Loading checkpoint shards: 100%|██████████| 2/2 [00:04<00:00,  2.36s/it]
Loading tokenizer daryl149/llama-2-7b-hf
0 special tokens added
Loading HH dataset (train split) from Huggingface...
Processing HH:   0%|          | 0/160800 [00:00<?, ?it/s]Processing HH:   1%|          | 1430/160800 [00:00<00:11, 14298.17it/s]Processing HH:   2%|▏         | 2860/160800 [00:00<00:11, 14285.29it/s]Processing HH:   3%|▎         | 4413/160800 [00:00<00:10, 14849.90it/s]Processing HH:   4%|▎         | 5921/160800 [00:00<00:10, 14939.55it/s]Processing HH:   5%|▍         | 7415/160800 [00:00<00:10, 14806.61it/s]Processing HH:   6%|▌         | 8896/160800 [00:00<00:10, 14725.70it/s]Processing HH:   6%|▋         | 10369/160800 [00:00<00:10, 14548.42it/s]Processing HH:   7%|▋         | 11857/160800 [00:00<00:10, 14649.69it/s]Processing HH:   8%|▊         | 13364/160800 [00:00<00:09, 14779.46it/s]Processing HH:   9%|▉         | 14843/160800 [00:01<00:13, 11001.90it/s]Processing HH:  10%|█         | 16369/160800 [00:01<00:11, 12048.00it/s]Processing HH:  11%|█         | 17885/160800 [00:01<00:11, 12856.20it/s]Processing HH:  12%|█▏        | 19360/160800 [00:01<00:10, 13368.82it/s]Processing HH:  13%|█▎        | 20837/160800 [00:01<00:10, 13757.23it/s]Processing HH:  14%|█▍        | 22285/160800 [00:01<00:09, 13961.27it/s]Processing HH:  15%|█▍        | 23804/160800 [00:01<00:09, 14315.44it/s]Processing HH:  16%|█▌        | 25265/160800 [00:01<00:09, 14220.99it/s]Processing HH:  17%|█▋        | 26708/160800 [00:01<00:09, 14274.63it/s]Processing HH:  18%|█▊        | 28166/160800 [00:02<00:09, 14364.36it/s]Processing HH:  18%|█▊        | 29726/160800 [00:02<00:08, 14728.23it/s]Processing HH:  19%|█▉        | 31209/160800 [00:02<00:08, 14757.06it/s]Processing HH:  20%|██        | 32747/160800 [00:02<00:08, 14941.03it/s]Processing HH:  21%|██▏       | 34246/160800 [00:02<00:11, 11039.27it/s]Processing HH:  22%|██▏       | 35774/160800 [00:02<00:10, 12053.02it/s]Processing HH:  23%|██▎       | 37326/160800 [00:02<00:09, 12936.12it/s]Processing HH:  24%|██▍       | 38857/160800 [00:02<00:08, 13567.30it/s]Processing HH:  25%|██▌       | 40361/160800 [00:02<00:08, 13972.77it/s]Processing HH:  26%|██▌       | 41820/160800 [00:03<00:08, 14122.99it/s]Processing HH:  27%|██▋       | 43277/160800 [00:03<00:08, 14159.68it/s]Processing HH:  28%|██▊       | 44724/160800 [00:03<00:08, 14140.17it/s]Processing HH:  29%|██▊       | 46160/160800 [00:03<00:08, 14183.54it/s]Processing HH:  30%|██▉       | 47594/160800 [00:03<00:08, 14106.85it/s]Processing HH:  30%|███       | 49016/160800 [00:03<00:07, 14073.08it/s]Processing HH:  31%|███▏      | 50431/160800 [00:03<00:07, 14073.36it/s]Processing HH:  32%|███▏      | 51844/160800 [00:03<00:07, 14030.78it/s]Processing HH:  33%|███▎      | 53256/160800 [00:03<00:07, 14056.32it/s]Processing HH:  34%|███▍      | 54665/160800 [00:03<00:07, 13805.03it/s]Processing HH:  35%|███▍      | 56068/160800 [00:04<00:07, 13870.16it/s]Processing HH:  36%|███▌      | 57457/160800 [00:04<00:10, 9771.52it/s] Processing HH:  37%|███▋      | 58890/160800 [00:04<00:09, 10816.90it/s]Processing HH:  37%|███▋      | 60289/160800 [00:04<00:08, 11598.44it/s]Processing HH:  38%|███▊      | 61689/160800 [00:04<00:08, 12221.44it/s]Processing HH:  39%|███▉      | 63129/160800 [00:04<00:07, 12812.17it/s]Processing HH:  40%|████      | 64534/160800 [00:04<00:07, 13156.15it/s]Processing HH:  41%|████      | 65939/160800 [00:04<00:07, 13401.75it/s]Processing HH:  42%|████▏     | 67336/160800 [00:05<00:06, 13562.30it/s]Processing HH:  43%|████▎     | 68751/160800 [00:05<00:06, 13733.58it/s]Processing HH:  44%|████▎     | 70145/160800 [00:05<00:06, 13548.31it/s]Processing HH:  44%|████▍     | 71527/160800 [00:05<00:06, 13626.67it/s]Processing HH:  45%|████▌     | 72957/160800 [00:05<00:06, 13824.60it/s]Processing HH:  46%|████▋     | 74389/160800 [00:05<00:06, 13969.38it/s]Processing HH:  47%|████▋     | 75810/160800 [00:05<00:06, 14036.16it/s]Processing HH:  48%|████▊     | 77218/160800 [00:05<00:05, 13945.61it/s]Processing HH:  49%|████▉     | 78616/160800 [00:05<00:05, 13916.40it/s]Processing HH:  50%|████▉     | 80031/160800 [00:05<00:05, 13985.45it/s]Processing HH:  51%|█████     | 81449/160800 [00:06<00:05, 14041.70it/s]Processing HH:  52%|█████▏    | 82855/160800 [00:06<00:05, 14011.30it/s]Processing HH:  52%|█████▏    | 84257/160800 [00:06<00:05, 13960.09it/s]Processing HH:  53%|█████▎    | 85654/160800 [00:06<00:05, 13950.12it/s]Processing HH:  54%|█████▍    | 87050/160800 [00:06<00:08, 8229.92it/s] Processing HH:  55%|█████▍    | 88153/160800 [00:06<00:08, 8282.06it/s]Processing HH:  55%|█████▌    | 89179/160800 [00:06<00:08, 8263.33it/s]Processing HH:  56%|█████▌    | 90143/160800 [00:07<00:08, 8340.18it/s]Processing HH:  57%|█████▋    | 91075/160800 [00:07<00:08, 8345.64it/s]Processing HH:  57%|█████▋    | 91979/160800 [00:07<00:08, 8375.80it/s]Processing HH:  58%|█████▊    | 92866/160800 [00:07<00:08, 8327.07it/s]Processing HH:  58%|█████▊    | 93733/160800 [00:07<00:08, 8306.07it/s]Processing HH:  59%|█████▉    | 94587/160800 [00:07<00:08, 8216.64it/s]Processing HH:  59%|█████▉    | 95425/160800 [00:07<00:07, 8195.38it/s]Processing HH:  60%|█████▉    | 96256/160800 [00:07<00:07, 8202.56it/s]Processing HH:  60%|██████    | 97084/160800 [00:07<00:07, 8200.31it/s]Processing HH:  61%|██████    | 97928/160800 [00:07<00:07, 8265.74it/s]Processing HH:  61%|██████▏   | 98759/160800 [00:08<00:07, 8197.59it/s]Processing HH:  62%|██████▏   | 99582/160800 [00:08<00:07, 8138.03it/s]Processing HH:  62%|██████▏   | 100398/160800 [00:08<00:07, 8038.02it/s]Processing HH:  63%|██████▎   | 101222/160800 [00:08<00:07, 8096.76it/s]Processing HH:  63%|██████▎   | 102050/160800 [00:08<00:07, 8150.61it/s]Processing HH:  64%|██████▍   | 102936/160800 [00:08<00:06, 8359.55it/s]Processing HH:  65%|██████▍   | 103784/160800 [00:08<00:06, 8391.25it/s]Processing HH:  65%|██████▌   | 104624/160800 [00:08<00:06, 8307.14it/s]Processing HH:  66%|██████▌   | 105489/160800 [00:08<00:06, 8406.24it/s]Processing HH:  66%|██████▌   | 106331/160800 [00:08<00:06, 8294.81it/s]Processing HH:  67%|██████▋   | 107162/160800 [00:09<00:06, 8162.37it/s]Processing HH:  67%|██████▋   | 107979/160800 [00:09<00:06, 8070.24it/s]Processing HH:  68%|██████▊   | 109034/160800 [00:09<00:05, 8796.26it/s]Processing HH:  69%|██████▊   | 110271/160800 [00:09<00:05, 9846.56it/s]Processing HH:  69%|██████▉   | 111465/160800 [00:09<00:04, 10462.48it/s]Processing HH:  70%|███████   | 112682/160800 [00:09<00:04, 10969.01it/s]Processing HH:  71%|███████   | 113894/160800 [00:09<00:04, 11310.58it/s]Processing HH:  72%|███████▏  | 115177/160800 [00:09<00:03, 11764.17it/s]Processing HH:  72%|███████▏  | 116418/160800 [00:09<00:03, 11956.63it/s]Processing HH:  73%|███████▎  | 117623/160800 [00:09<00:03, 11983.19it/s]Processing HH:  74%|███████▍  | 118823/160800 [00:10<00:03, 11975.05it/s]Processing HH:  75%|███████▍  | 120065/160800 [00:10<00:03, 12106.51it/s]Processing HH:  75%|███████▌  | 121319/160800 [00:10<00:03, 12235.66it/s]Processing HH:  76%|███████▌  | 122585/160800 [00:10<00:03, 12360.68it/s]Processing HH:  77%|███████▋  | 123822/160800 [00:10<00:05, 6774.15it/s] Processing HH:  78%|███████▊  | 125054/160800 [00:10<00:04, 7826.55it/s]Processing HH:  79%|███████▊  | 126248/160800 [00:10<00:03, 8703.96it/s]Processing HH:  79%|███████▉  | 127506/160800 [00:11<00:03, 9608.51it/s]Processing HH:  80%|████████  | 128757/160800 [00:11<00:03, 10334.22it/s]Processing HH:  81%|████████  | 130012/160800 [00:11<00:02, 10917.11it/s]Processing HH:  82%|████████▏ | 131240/160800 [00:11<00:02, 11288.90it/s]Processing HH:  82%|████████▏ | 132453/160800 [00:11<00:02, 11524.77it/s]Processing HH:  83%|████████▎ | 133706/160800 [00:11<00:02, 11811.70it/s]Processing HH:  84%|████████▍ | 134928/160800 [00:11<00:02, 11889.40it/s]Processing HH:  85%|████████▍ | 136151/160800 [00:11<00:02, 11987.69it/s]Processing HH:  85%|████████▌ | 137404/160800 [00:11<00:01, 12144.08it/s]Processing HH:  86%|████████▌ | 138633/160800 [00:11<00:01, 12109.38it/s]Processing HH:  87%|████████▋ | 139855/160800 [00:12<00:01, 12090.38it/s]Processing HH:  88%|████████▊ | 141072/160800 [00:12<00:01, 12097.51it/s]Processing HH:  88%|████████▊ | 142288/160800 [00:12<00:01, 12115.53it/s]Processing HH:  89%|████████▉ | 143504/160800 [00:12<00:01, 11791.79it/s]Processing HH:  90%|████████▉ | 144688/160800 [00:12<00:01, 11720.42it/s]Processing HH:  91%|█████████ | 145863/160800 [00:12<00:01, 11716.47it/s]Processing HH:  91%|█████████▏| 147037/160800 [00:12<00:01, 11596.12it/s]Processing HH:  92%|█████████▏| 148212/160800 [00:12<00:01, 11639.73it/s]Processing HH:  93%|█████████▎| 149462/160800 [00:12<00:00, 11893.75it/s]Processing HH:  94%|█████████▎| 150653/160800 [00:12<00:00, 11734.48it/s]Processing HH:  94%|█████████▍| 151846/160800 [00:13<00:00, 11790.44it/s]Processing HH:  95%|█████████▌| 153026/160800 [00:13<00:00, 11660.67it/s]Processing HH:  96%|█████████▌| 154193/160800 [00:13<00:00, 11608.66it/s]Processing HH:  97%|█████████▋| 155377/160800 [00:13<00:00, 11675.54it/s]Processing HH:  97%|█████████▋| 156556/160800 [00:13<00:00, 11707.14it/s]Processing HH:  98%|█████████▊| 157728/160800 [00:13<00:00, 11610.04it/s]Processing HH:  99%|█████████▉| 158890/160800 [00:13<00:00, 11606.71it/s]Processing HH: 100%|█████████▉| 160066/160800 [00:13<00:00, 11651.58it/s]Processing HH: 100%|██████████| 160800/160800 [00:13<00:00, 11597.05it/s]
Loading HH dataset (test split) from Huggingface...
Processing HH:   0%|          | 0/8552 [00:00<?, ?it/s]Processing HH:  17%|█▋        | 1464/8552 [00:00<00:00, 14639.11it/s]Processing HH:  34%|███▍      | 2932/8552 [00:00<00:00, 14659.67it/s]Processing HH:  51%|█████▏    | 4398/8552 [00:00<00:00, 14496.59it/s]Processing HH:  68%|██████▊   | 5848/8552 [00:00<00:00, 11741.86it/s]Processing HH:  83%|████████▎ | 7084/8552 [00:00<00:00, 5184.45it/s] Processing HH:  97%|█████████▋| 8304/8552 [00:01<00:00, 6321.86it/s]Processing HH: 100%|██████████| 8552/8552 [00:01<00:00, 7774.63it/s]
starting 3 processes for FSDP training
setting RLIMIT_NOFILE soft limit to 1048576 from 1024
3
0 initializing distributed
Creating trainer on process 0 with world size 3
Finished generating 512 examples on test split
Loaded 32 eval batches of size 16
Sharding models...
Attempting to enable activation checkpointing...
Applying activation checkpointing wrapper to policy...
FSDP activation checkpointing enabled!
Loaded model on rank 0
Using RMSprop optimizer with learning rate 1e-06
Running evaluation after 0 train examples
Computing eval metrics:   0%|          | 0/32 [00:00<?, ?it/s]/home/wxt/.conda/envs/halos3/lib/python3.10/site-packages/torch/utils/checkpoint.py:61: UserWarning: None of the inputs have requires_grad=True. Gradients will be None
  warnings.warn(
/home/wxt/.conda/envs/halos3/lib/python3.10/site-packages/torch/utils/checkpoint.py:61: UserWarning: None of the inputs have requires_grad=True. Gradients will be None
  warnings.warn(
/home/wxt/.conda/envs/halos3/lib/python3.10/site-packages/torch/utils/checkpoint.py:61: UserWarning: None of the inputs have requires_grad=True. Gradients will be None
  warnings.warn(
Computing eval metrics:   3%|▎         | 1/32 [00:02<01:21,  2.62s/it]Computing eval metrics:   6%|▋         | 2/32 [00:04<00:57,  1.93s/it]Computing eval metrics:   9%|▉         | 3/32 [00:04<00:38,  1.34s/it]Computing eval metrics:  12%|█▎        | 4/32 [00:05<00:29,  1.04s/it]Computing eval metrics:  16%|█▌        | 5/32 [00:05<00:24,  1.11it/s]Computing eval metrics:  19%|█▉        | 6/32 [00:06<00:20,  1.28it/s]Computing eval metrics:  22%|██▏       | 7/32 [00:07<00:17,  1.41it/s]Computing eval metrics:  25%|██▌       | 8/32 [00:07<00:15,  1.52it/s]Computing eval metrics:  28%|██▊       | 9/32 [00:08<00:14,  1.60it/s]Computing eval metrics:  31%|███▏      | 10/32 [00:09<00:19,  1.11it/s]Computing eval metrics:  34%|███▍      | 11/32 [00:10<00:16,  1.25it/s]Computing eval metrics:  38%|███▊      | 12/32 [00:10<00:14,  1.37it/s]Computing eval metrics:  41%|████      | 13/32 [00:11<00:12,  1.46it/s]Computing eval metrics:  44%|████▍     | 14/32 [00:12<00:11,  1.50it/s]Computing eval metrics:  47%|████▋     | 15/32 [00:12<00:10,  1.55it/s]Computing eval metrics:  50%|█████     | 16/32 [00:13<00:10,  1.57it/s]Computing eval metrics:  53%|█████▎    | 17/32 [00:13<00:09,  1.64it/s]Computing eval metrics:  56%|█████▋    | 18/32 [00:14<00:08,  1.67it/s]Computing eval metrics:  59%|█████▉    | 19/32 [00:14<00:07,  1.68it/s]Computing eval metrics:  62%|██████▎   | 20/32 [00:15<00:07,  1.71it/s]Computing eval metrics:  66%|██████▌   | 21/32 [00:16<00:06,  1.75it/s]Computing eval metrics:  69%|██████▉   | 22/32 [00:16<00:05,  1.77it/s]Computing eval metrics:  72%|███████▏  | 23/32 [00:17<00:05,  1.74it/s]Computing eval metrics:  75%|███████▌  | 24/32 [00:17<00:04,  1.76it/s]Computing eval metrics:  78%|███████▊  | 25/32 [00:18<00:04,  1.74it/s]Computing eval metrics:  81%|████████▏ | 26/32 [00:18<00:03,  1.67it/s]Computing eval metrics:  84%|████████▍ | 27/32 [00:19<00:02,  1.70it/s]Computing eval metrics:  88%|████████▊ | 28/32 [00:20<00:02,  1.71it/s]Computing eval metrics:  91%|█████████ | 29/32 [00:20<00:01,  1.74it/s]Computing eval metrics:  94%|█████████▍| 30/32 [00:21<00:01,  1.70it/s]Computing eval metrics:  97%|█████████▋| 31/32 [00:21<00:00,  1.73it/s]Computing eval metrics: 100%|██████████| 32/32 [00:22<00:00,  1.75it/s]Computing eval metrics: 100%|██████████| 32/32 [00:22<00:00,  1.43it/s]
